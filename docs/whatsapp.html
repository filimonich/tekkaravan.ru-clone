<!DOCTYPE html> 
<html lang="ru"> 
<head> 
	<meta charset="UTF-8"> 
	<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, shrink-to-fit=no"> 
	<link rel="shortcut icon" href="images/favicon.ico"> 
	<link rel="stylesheet" href="style.css"> 
	<title></title> 
</head>
<body class="blind"> 
	<header class="header" data-scroll-lock-fill-gap>
		<div class="header__top container">
			<a class="header__logo" href="./">
				<!-- <img src="./images/logo.png" alt=""> -->
				<img src="./images/logo_.png" alt="">
			</a>
			<form action="./" class="header__search search">
				<input class="search__input" type="text" placeholder="Поиск">
				<input class="search__submit" type="submit" value="">
			</form>
			<div class="header__navi navi" data-scroll-lock-scrollable>
				<buton class="navi__close"></buton>
				<form action="./" class="navi__search search">
					<input class="search__input" type="text" placeholder="Поиск">
					<input class="search__submit" type="submit" value="">
				</form>
				<nav class="navi__menu">
					<a class="navi__link navi__link_services navi__link_dropdown" href="#">Сервисы Bellatrix</a>
					<div class="navi__submenu">
						<a href="./">WhatsApp</a>					
						<a href="./">История рассылок WhatsApp</a>					
						<a href="./sending.html">Push рассылка</a>
						<a href="./">Email рассылка</a>
						<a href="./control.html">Контроль сотрудников</a>
						<a href="./">Справочник</a>
						<a href="./guests.html">Гости</a>
					</div>
					<a class="navi__link navi__link_profile" href="./">Профиль</a>
					<a class="navi__link navi__link_cargo" href="./job.html">Грузы</a>
					<a class="navi__link navi__link_drivers" href="./owner_profile.html">Перевозчики</a>
					<a class="navi__link navi__link_tracks" href="./tech_details.html">Track-маркет</a>
					<a class="navi__link navi__link_parts" href="./autoparts.html">Автозапчасти</a>
					<a class="navi__link navi__link_carrier" href="./carrier.html">Карьера</a>
					<a class="navi__link navi__link_users" href="./">Пользователи</a>
					<a class="navi__link navi__link_tracking" href="./">Отслеживание ТС</a>
					<a class="navi__link navi__link_payment" href="./">Оплата</a>
					<a class="navi__link navi__link_login" href="./" data-modal="login">Вход</a>
					<!-- <a class="navi__link navi__link_logout" href="./">Выход</a> -->
				</nav>
			</div>
			<div class="header__controls">
				<a class="header__login" href="./" data-modal="login">Вход</a>
				<!-- <a class="header__logout" href="./">Выход</a> -->
				<a class="header__register" href="./">Регистрация</a>
			</div>
			<button class="header__toggle"></button>
			<button class="header__talk"></button>
		</div>
		<div class="header__bottom">
			<button class="header__tongue blind__toggle"></button>
		</div>
	</header> 


<!-- {% if err == true %}
<section class="ftco-section bg-light">
    <div class="container">
        <div class="row">
            <div class="col-md-4">
                <div class="intro ftco-animate">
                </div>
            </div>
            <div class="col-md-4">
                <div class="intro ftco-animate">
                    {{ err }}
                </div>
            </div>
        </div>
    </div>
</section>
{% else %} -->

<div class="top mbt1">
    <div class="top__inner container">
        <div class="top__side breadcrumbs">
            <a class="breadcrumbs__item" href="{{ url }}">Главная</a>
            <a class="breadcrumbs__item" href="{{ url }}/whatsapp">Рассылки на WhatsApp</a>
            <!-- <span class="breadcrumbs__item breadcrumbs__item_current">{{ titleJobs }}</span> -->
            <span class="breadcrumbs__item breadcrumbs__item_current">Рассылки на WhatsApp</span>
        </div>
    </div>
</div>

<div class="section__layout container">

    <form class="section__unit section__unit_desktop form filter__form" action="./">
        <h2 class="title section__toggle section__toggle_desktop">Рассылки на WhatsApp</h2>
        <div class="section__collapse section__collapse_desktop">
            <div class="form__body form__body_fourfold mbt1">
                <label class="form__field form__field_geo" data-title="Откуда">
                    <input type="text" />
                    <hr>
                    <input type="text" placeholder="км" />
                </label>
                <label class="form__field form__field_geo" data-title="Куда">
                    <input type="text" />
                    <hr>
                    <input type="text" placeholder="км" />
                </label>
                <label class="form__field form__field_txt" data-title="Культура">
                    <input type="text" />
                </label>
                <label class="form__field form__field_txt" data-title="Объем">
                    <input type="text" />
                </label>
                <select class="form__field form__field_sel" data-title="Тип кузова">
                    <option value="1">Тентованный</option>
                    <option value="2">Не тентованный</option>
                </select>
                <select class="form__field form__field_sel" data-title="Тип загрузки">
                    <option value="1">Верхняя</option>
                    <option value="2">Нижняя</option>
                    <option value="3">Боковая</option>
                </select>
                <label class="form__field form__field_txt" data-title="Экспортер">
                    <input type="text" />
                </label>
                <label class="form__field form__field_txt" data-title="Погрузка">
                    <input type="text" />
                </label>
            </div>
            <div class="form__buttons form__buttons_grid">
                <button class="form__button button button_find" type="button">Разлогинить WhatsApp</button>
                <button class="form__button button button_reset" type="button">Очистить WhatsApp</button>
            </div>
        </div>
    </form>

</div>










{% endif %}

<section class="checkout-section spad">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8 order-2 order-lg-1">
                <form class="search-destination" id="commentForm" action="{{ url }}/whatsapp" method="post"
                    enctype="multipart/form-data">
                    <div class="cf-title my-4">Рассылки на WhatsApp</div>

                    <a class="dante_karavan_link2" href="{{ url }}/whatsapp/logout">Разлогинить WhatsApp</a>
                    <a class="dante_karavan_link2" href="{{ url }}/whatsapp/iscleared">Очистить WhatsApp</a>
                    {{ err }}

                    <div class="row address-inputs">
                        <div class="col-12">База

                            <select class="form-control" name="pagesone" id="WhatsAppPagesId">
                                <option>Выберите базу</option>
                                {{ baseOptions | raw }}

                            </select>
                        </div>
                        <div class="col-12">
                            Выберите блок:
                            <div id="WhatsAppSubPagesId">
                                <select name="pages" id="idBlockWhatsApps">
                                    <option>Выберите блок</option>
                                </select>
                            </div>
                        </div>


                        <div class="col-12">Текст сообщения:
                            <textarea class="form-control mt-3 bellatrix-whatsapp-textarea" name="text" id="text"
                                cols="30" rows="1" placeholder="Текст сообщения"></textarea>

                            <a id="send_voice_message" href="#"><i class="fa fa-microphone"></i></a>
                            <label class="bellatrix-whatsapp-file">
                                <i class="fa fa-paperclip" aria-hidden="true"></i>
                                <input type="file" name="image" id="whatsapp_img">
                                <input type="hidden" name="url" id="url">
                                <input type="hidden" name="fname" id="fname">
                                <input type="hidden" name="uid" id="uid" value="<?= id($_SESSION['id']) ?>">
                            </label>
                            <small style="float: right">Максимальный размер файла WhatsApp 37 мбайт<br>
                                <span style="color: #16cd63;" id="fupload"></span></small>
                        </div>



                        <div class="col-12 mt-3">
                            <button type="submit" class="site-btn submit-order-btn" name="submit">Отправить</button>

                        </div>
                    </div>
            </div>
            <script>
                const wi = document.querySelector('#whatsapp_img');
                const fu = document.querySelector('#fupload');
                const url = document.querySelector('#url');
                const name = document.querySelector('#fname');

                wi.addEventListener('change', (e) => {
                    upload();
                });
                function upload() {
                    let data = new FormData();
                    let upload = document.getElementById('whatsapp_img');
                    let user_id = <? php echo $_SESSION['id']; ?>;
                    data.append('image', upload.files[0]);
                    data.append('id', user_id);
                    data.append('submit', "1");
                    fetch('/ajax/file_upload.php', {
                        method: 'POST',
                        body: data
                    }).then(
                        success => success.text().then(
                            function (text) {
                                console.log(text);
                                fu.innerHTML = text;
                                let fname = text.replace("Файл ", "").replace(" успешно загружен", "").trim();
                                console.log(fname);
                                name.value = fname;
                                let furl = 'https://gamma24.su/uploads/' + user_id + '/' + fname;
                                console.log(furl);
                                url.value = furl;
                            }) // Handle the success response object
                    ).catch(
                        error => console.log(error) // Handle the error response object
                    );
                }
            </script>
        </div>
</section>


<div class="voice-message-modal">
    <div class="voice-wrapper">
        <div class="voice-preview">
            <div class="preview-header">Идет запись</div>
            <audio controls="" src=""></audio>
        </div>

        <div class="controls">
            <div class="send-rec"><i class="fa fa-paper-plane"></i></div>
            <div class="cancel-rec"><i class="fa fa-times-circle"></i></div>

            <div class="stop-rec"><i class="fa fa-stop"></i></div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/RecordRTC/5.5.6/RecordRTC.js"></script>
<script src="/style/js/recorder.js"></script>
<link rel="stylesheet" href="{{ url }}/style/css/select2.min.css">
<script src="{{ url }}/style/js/whatsAppBlocks.js"></script>
<script src="{{ url }}/style/js/select2.min.js"></script>
<script src="{{ url }}/style/js/select2rulang.js"></script>

<script>

    $(document).ready(function () {
        $('.checkout-form select').select2({
            language: "ru"
        });
    });

    $(document).on('select2:open', () => {
        document.querySelector('.select2-search__field').focus();
    });
</script>