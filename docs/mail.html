<!DOCTYPE html>
<html lang="ru">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, shrink-to-fit=no">
	<link rel="shortcut icon" href="images/favicon.ico">
	<link rel="stylesheet" href="style.css">
</head>
<body class="blind dropped">
	<header class="header" data-scroll-lock-fill-gap>
		<div class="header__top container">
			<a class="header__logo" href="./">
				<!-- <img src="./images/logo.png" alt=""> -->
				<img src="./images/logo_.png" alt="">
			</a>
			<form action="./" class="header__search search">
				<input class="search__input" type="text" placeholder="Поиск">
				<input class="search__submit" type="submit" value="">
			</form>
			<div class="header__navi navi" data-scroll-lock-scrollable>
				<buton class="navi__close"></buton>
				<form action="./" class="navi__search search">
					<input class="search__input" type="text" placeholder="Поиск">
					<input class="search__submit" type="submit" value="">
				</form>
				<nav class="navi__menu">
					<a class="navi__link navi__link_services navi__link_dropdown" href="#">Сервисы Bellatrix</a>
					<div class="navi__submenu">
						<a href="./">WhatsApp</a>
						<a href="./">История рассылок WhatsApp</a>
						<a href="./sending.html">Push рассылка</a>
						<a href="./">Email рассылка</a>
						<a href="./control.html">Контроль сотрудников</a>
						<a href="./">Справочник</a>
						<a href="./guests.html">Гости</a>
					</div>
					<a class="navi__link navi__link_profile" href="./">Профиль</a>
					<a class="navi__link navi__link_cargo" href="./job.html">Грузы</a>
					<a class="navi__link navi__link_drivers" href="./owner_profile.html">Перевозчики</a>
					<a class="navi__link navi__link_tracks" href="./tech_details.html">Track-маркет</a>
					<a class="navi__link navi__link_parts" href="./autoparts.html">Автозапчасти</a>
					<a class="navi__link navi__link_carrier" href="./carrier.html">Карьера</a>
					<a class="navi__link navi__link_users" href="./">Пользователи</a>
					<a class="navi__link navi__link_tracking" href="./">Отслеживание ТС</a>
					<a class="navi__link navi__link_payment" href="./">Оплата</a>
					<a class="navi__link navi__link_login" href="./" data-modal="login">Вход</a>
					<!-- <a class="navi__link navi__link_logout" href="./">Выход</a> -->
				</nav>
			</div>
			<div class="header__controls">
				<a class="header__login" href="./" data-modal="login">Вход</a>
				<!-- <a class="header__logout" href="./">Выход</a> -->
				<a class="header__register" href="./">Регистрация</a>
			</div>
			<button class="header__toggle"></button>
			<button class="header__talk"></button>
		</div>
		<div class="header__bottom">
			<!-- <button class="header__tongue blind__toggle"></button> -->
		</div>
	</header>

<div class="top mbt1">
  <div class="top__inner container">
    <div class="top__side breadcrumbs">
      <a class="breadcrumbs__item" href="./">Главная</a>
      <span class="breadcrumbs__item breadcrumbs__item_current">Рассылки на E-Mail</span>
    </div>
  </div>
</div>


<section class="section mb2">
  <div class="section__layout container">
    <div class="section__unit">
      <h2 class="title mb1">Рассылки на E-Mail</h2>
      <div class="form__buttons form__buttons_grid_whatsapp">
        <button class="form__button button form__button" type="button" data-toggle="modal"
          data-target="#email-templates">Шаблоны писем
        </button>
      </div>
      <form action="{{ url }}/emailhistory/id=<?= ($request['MAX(id)'] + 1) ?>" class="form mbt1 checkout-form"
        method="post" id="commentForm">
        <div class="form__body mb1">

          <label class="form__field form__field_txt mb1" data-title="Тема письма">
            <input name="subject" type="text" />
          </label>

          <!--<label class="form__field form__field_area form__field_wide" data-title="Текст сообщения">-->
          <textarea name="text" id="editor" placeholder="Текст сообщения" style="display: none;"></textarea>
          <!--</label>-->

          <select name="pages" id="emailPagesId" class="form__field form__field_sel form-s__item mt1">
            data-title="Форма оплаты" />
            <option disabled selected value="0">-- выберете базу --</option>
            <option value="ind">Указать почту</option>
            <option value="{{ data.title_en }}">{{ data.title_ru }}</option>
          </select>

          <div class="col-sm-12" id="email_input" style="display: none;">Email:
            <input name="email" type="text" class="form-control">
            <small>Укажите e-mail адреса через запятую</small>
          </div>

          <div class="col-sm-12" id="blocks_input">Блоки:
            <div id="emailSubPagesId">
              <select name="idBlockEmail" id="idBlockEmails">
                <option disabled selected value>Выберите блок</option>
              </select>
            </div>
          </div>

          <!-- <script src="{{ url }}/libs/ckeditor/ckeditor.js"></script>
          <script type="text/javascript">
            CKEDITOR.replace('editor', {
              language: 'ru',
              allowedContent: true,
              extraAllowedContent: '*{*}',
              fullPage: true,
              basicEntities: false
            });
          </script> -->

        </div>
        <div class="form__buttons form__buttons_grid col-12">
          <button class="form__button button button_send" name="submit" type="submit">Отправить</button>
        </div>
      </form>

    </div>
  </div>
</section>


<!-- Modal -->
<div class="modal fade" id="email-templates" tabindex="-1" role="dialog" aria-labelledby="Шаблоны писем"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Шаблоны писем</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body row">
        <div class="col-lg-4 col-sm-6 col-12">
          <!--<button type="button" loadhtml="mail-supplier" onclick="loadTemplate(this)">
				<div class="image"><img class="w-100" src="{{ url }}/bellatrix/email-templates/images/mail-supplier.png" alt=""></div>
				<div class="subtitle">Предложение поставщикам</div>
			</button>-->
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Закрыть</button>
      </div>
    </div>
  </div>
</div>

<style>
  #email-templates .modal-dialog {
    max-width: 1100px;
  }

  #email-templates .modal-content {
    min-height: 75vh;
  }

  #email-templates .image {
    height: 200px;
    overflow-y: scroll;
  }

  #email-templates .subtitle {
    font-size: 20px;
    font-weight: 600;
    margin-top: 15px;
  }

  #email-templates .modal-body button {
    border: 2px solid #bec3c8 !important;
    box-shadow: 0 0 0 60px rgb(0 0 0 / 0%) inset, 0.1em 0.1em 0.2em #04080c !important;
    border-radius: 13px;
  }
</style>

<!-- Modal -->
<div class="modal modal2 fade" id="email-templates" tabindex="-1" role="dialog" aria-labelledby="Текст письма"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-body row align-items-center">
        <div class="col-md-8 col-12">
          <h3>E-mail рассылка в процессе</h3>
          <p>Не закрывайте эту вкладку пока идет рассылка.</p>
          <p>По заверешию рассылки это окно закроется автоматически.</p>
        </div>
        <div class="col-md-4 col-12">
          <img src="/images/mail-download.gif" alt="">
        </div>
      </div>
    </div>
  </div>
</div>

<!-- <script>
  const opt = document.querySelector('#emailPagesId');
  const blocks = document.querySelector('#blocks_input');
  const email = document.querySelector('#email_input');
  opt.value = "0";

  if (opt.value === "ind") {
    email.style.display = "block";
    blocks.style.display = "none";
  } else {
    email.style.display = "none";
    blocks.style.display = "block";
  }

  opt.addEventListener('change', (e) => {
    if (opt.value === "ind") {
      email.style.display = "block";
      blocks.style.display = "none";
    } else {
      email.style.display = "none";
      blocks.style.display = "block";
    }
  });

  function loadTemplate(item) {
    $.get(`/bellatrix/email-templates/files/${$(item).attr('loadhtml')}.html`).done(response => {
      CKEDITOR.instances['editor'].setData(response);
    }).fail();
    $('.modal').modal('hide')
  }

  let pageId;

  $('.checkout-form button[name="submit"]').click(function () {
    let ok = true;

    let sub = $('.checkout-form input[name="subject"]').val();
    let email = $('.checkout-form input[name="email"]').val();
    let text = CKEDITOR.instances.editor.getData();
    let block = $('.checkout-form select[name="idBlockEmail"]').val();
    let pages = $('.checkout-form select[name="pages"]').val();

    if (sub === "" || sub === null) {
      alert("Заполните тему письма");
      ok = false;
    }
    if (pages === "ind") {
      if (email === "" || email === null) {
        alert("Заполните почту");
        ok = false;
      }
    }
    if (pages !== "ind") {
      if (block === "" || block === null) {
        alert("Выберете блок для рассылки");
        ok = false;
      }
    }

    if (ok === true) {
      $.ajax({
        url: "/ajax/email_send.php",
        type: "post",
        dataType: "json",
        data: {
          "subject": sub,
          "email": email,
          "text": text,
          "block": block,
          "pages": pages
        },
        beforeSend: function () {
          $('.modal2').modal('show')
        },
        success: function (data) {
          pageId = data.pageId
        },
        complete: function () {
          $('.modal2').modal('hide')
          window.location.href = "https://tekkaravan.ru/?index=email_history_id?id=" + pageId;
        }
      });
    }
  })
</script> -->

<link rel="stylesheet" href="{{ url }}/style/css/select2.min.css">
<script src="{{ url }}/style/js/mailBlocks.js"></script>
<script src="{{ url }}/style/js/select2.min.js"></script>
<script src="{{ url }}/style/js/select2rulang.js"></script>
<script src="{{ url }}/assets/jquery.min.js"></script>

<!-- <script>

  $(document).ready(function () {
    $('#idBlockEmails').select2({
      language: "ru"
    });
  });

  $(document).on('select2:open', () => {
    document.querySelector('.select2-search__field').focus();
  });
</script> -->







<div class="panel-bt" data-scroll-lock-fill-gap>
	<a class="panel-bt__link panel-bt__link_profile" href="./"></a>
	<a class="panel-bt__link panel-bt__link_calc" href="./"></a>
	<a class="panel-bt__link panel-bt__link_exit" href="./"></a>
	<!-- <a class="panel-bt__link panel-bt__link_login" href="./"></a> -->
</div>

<div class="modal__hidden">
	<div id="login">
		<form class="form form-ln" action="./">
			<h2 class="title mb1">Авторизация</h2>
			<div class="form__body form-ln__layout">
				<label class="form__field form__field_txt form-ln__item" data-title="Номер телефона">
					<input type="tel" placeholder="+7 (900) 123-45-67"/>
				</label>
				<label class="form__field form__field_pass form-ln__item" data-title="Пароль">
					<input type="password"/><button type="button"></button>
				</label>
			</div>
			<div class="form__alerts"></div>
			<div class="form__buttons form-ln__buttons form-ln__buttons_grid">
				<button class="form__button button form-ln__button" type="button">Войти</button>
				<button class="form__button button form-ln__button" type="button">Регистрация</button>
			</div>
			<div class="form__small">
				<strong><a href="./" data-modal="restore">Забыли пароль?</a></strong>
			</div>
		</form>
	</div>
	<div id="restore">
		<form class="form form-ln" action="./">
			<h2 class="title mb1">Восстановление пароля</h2>
			<div class="form__body form-ln__layout">
				<label class="form__field form__field_txt form-ln__item" data-title="Номер телефона">
					<input type="tel" placeholder="+7 (900) 123-45-67"/>
				</label>
				<label class="form__field form__field_txt form-ln__item" data-title="Email">
					<input type="password" placeholder="address@gmail.com"/>
				</label>
			</div>
			<div class="form__alerts"></div>
			<div class="form__buttons form-ln__buttons">
				<button class="form__button button form-ln__button" type="button">Восстановить</button>
			</div>
			<div class="form__small">
				Уже есть аккаунт? <strong><a href="./" data-modal="login">Войти</a></strong>
			</div>
		</form>
	</div>
</div>

<script> let outer_data = {
		lon: '39.7449517',
		lat: '47.2875759',
		distanse: '2',
		loading: 'Воронежская обл, г Богучар',
		unloading: 'Миллерово',
		drivers: [
			{
				type: 'Point',
				coordinates: [47.287446, 39.747379],
				balloonContentHeader: "Балун метки",
				balloonContentBody: "Содержимое <em>Водитель 1</em> метки",
				balloonContentFooter: "Подвал",
				hintContent: "Хинт метки"
			},
			{
				type: 'Point',
				coordinates: [47.278519, 39.771381],
				balloonContentHeader: "Балун метки",
				balloonContentBody: "Содержимое <em>Водитель 2</em> метки",
				balloonContentFooter: "Подвал",
				hintContent: "Хинт метки"
			},
			{
				type: 'Point',
				coordinates: [47.285819, 39.748381],
				balloonContentHeader: "Балун метки",
				balloonContentBody: "Содержимое <em>Водитель 3</em> метки",
				balloonContentFooter: "Подвал",
				hintContent: "Хинт метки"
			},
		]
	};

	// outer_data.drivers.forEach(driver => {
	// 	let placemark = new map.Placemark(driver.coordinates, {
	// 		balloonContentHeader: driver.balloonContentHeader,
	// 		balloonContentBody: driver.balloonContentBody,
	// 		balloonContentFooter: driver.balloonContentFooter,
	// 		hintContent: driver.hintContent,
	// 	});

	// 	map.geoObjects.add(placemark);
	// });

</script>

<script type="text/javascript" charset="utf-8" src="jquery.min.js"></script>
<script type="text/javascript" charset="utf-8" src="RecordRTC.min.js"></script>
<script src="common.js"></script>
</body>

</html>